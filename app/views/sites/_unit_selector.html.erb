<script>
  function refreshTable(form) {
    let url =
      "<%= url_for(controller: :weather, action: :site_data, lat: @lat, long: @long, end_date: @end_date).html_safe %>" +
      "&start_date=" +
      time_form.start_date.value +
      "&units=" +
      unit_form.units.value

    $.ajax({
      url: url,
      success: (response) => {
        $("#site-data").html(response);
      }
    })
  }
</script>

<div class="site-row">
  <h4>Table display options:</h4>
  <div class="site-box">
    <b><i>Units:</i></b>
    <%= form_tag nil, id: "unit_form" do %>
      <label><%= radio_button_tag :units, "imperial", @units == "imperial", onchange: "refreshTable(this.form)" %> Imperial (&deg;F, in, kWh/m<sup>2</sup>/day)</label><br>
      <label><%= radio_button_tag :units, "metric", @units == "metric", onchange: "refreshTable(this.form)" %> Metric (&deg;C, mm, mJ/m<sup>2</sup>/day)</label>
    <% end %>
    <br>
    <b><i>Time period</i></b>
    <%= form_tag nil, id: "time_form" do %>
      <% @start_date_opts.each do |name, val| %>
        <label>
          <%= radio_button_tag :start_date, val, val == @start_date, onchange: "refreshTable(this.form)" %>
          <%= name %>
        </label>
      <% end %>
    <% end %>
  </div>
</div>
