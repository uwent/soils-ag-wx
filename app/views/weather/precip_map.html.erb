<% @title = "Gridded Precipitation Data" %>
<% @welcome_image = "precip-map-250px.png" %>

<% content_for :welcome do %>
  <h2><%= link_to @title %></h2>
  <p>Precipitation data is pulled from gridded daily total precipitation datasets generated by the National Oceanographic and Atmospheric Administration and provided here for easy access.</p>
<% end %>

<%= javascript_include_tag "map_functions" %>
<% if @is_post %><%= javascript_include_tag "scroll_to_form" %><% end %>

<h2><%= link_to @title %></h2>

<hr>

<p>Use this page to access precipitation data for the upper Midwest. This data is collected daily from NOAA gridded datasets.</p>

<%= render partial: "partials/map_navigator" %>

<br>

<%= render_async "map_image",
  method: "POST",
  data: { endpoint: @endpoint, id: @date, query: {units: @units, start_date: @start_date}.compact }.to_json,
  error_message: "<p>Sorry, unable to load map. Please try again.</p>" do %>
  <div class="map-loading">
    <b>Loading map, please wait...</b>
  </div>
<% end %>

<div class="note">
  Note: Map color scale is based on min/max daily precipitation across region. Map may take a few moments to load if it hasn't already been created. Precipitation data is not available for Canada from our data source. <%= link_to "Download the entire grid of data in CSV format", action: :precip_map, format: :csv, params: { date: @date } %>.
</div>

<hr>

<h4>Get Precipitation Data Time Series</h4>

<div class="note">
  Note: You can click on the map to set the latitude and longitude.
</div>

<%= render partial: "partials/grid_selector", locals: { target: "/weather/precip_data.js" } %>

<div id="map-data"></div>

<br>

<%= link_to "Back", :back %>
